{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/media/darcdev/Archivos/Usuario/1-ESTUDIO/UNIVERSIDAD/V SEMESTRE/INGENIERIA DE SOFTWARE I/Proyecto/implementaci\\xF3n/frontend/components/Metric.js\";\nimport { useEffect, useRef } from \"react\";\nimport Graph from \"../components/Graph\";\nimport format from \"date-fns/format\";\nimport { parseISO } from \"date-fns\";\nimport axios from \"axios\";\nimport getConfig from \"next/config\";\nconst {\n  publicRuntimeConfig: publicConfig\n} = getConfig();\nexport default function Metric({\n  disconnected,\n  uuid,\n  socket,\n  type,\n  mtToken\n}) {\n  const graphReference = useRef();\n  useEffect(() => {\n    async function fetchMetrics() {\n      try {\n        const {\n          data: dataResult\n        } = await axios.get(`${publicConfig.api_url}/api/metrics/${uuid}/${type}`);\n        if (!graphReference.current) return;\n        const chart = graphReference.current;\n        const dataset = chart.data.datasets[0];\n        const data = chart.data;\n        const orderData = dataResult.reverse();\n\n        if (Array.isArray(orderData)) {\n          orderData.forEach(m => {\n            data.labels.push(format(parseISO(m.createdat), \"HH:mm:ss\"));\n            dataset.data.push(m.value);\n            chart.update(\"none\");\n            chart.update();\n          });\n        }\n      } catch (error) {\n        return;\n      }\n    }\n\n    fetchMetrics();\n\n    if (socket) {\n      socket.on(\"agent/message\", payload => {\n        if (payload.token !== mtToken) return;\n\n        if (payload.agent.uuid === uuid) {\n          const metric = payload.metrics.find(m => m.type === type);\n          if (!graphReference.current) return;\n          const chart = graphReference.current;\n          const data = chart.data.datasets[0].data;\n          const labels = chart.data.labels;\n\n          if (data.length >= 20) {\n            labels.shift();\n            data.shift();\n          }\n\n          const labelM = format(metric.createdat, \"HH:mm:ss\");\n          const dataM = metric.value;\n          labels.push(labelM);\n          data.push(dataM);\n          chart.update(\"active\");\n        }\n      });\n    }\n  }, [disconnected]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"border-gray-200 rounded-lg h-auto md:p-4\\t\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \" bg-gray-50 p-2\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"h-auto\",\n        children: /*#__PURE__*/_jsxDEV(Graph, {\n          graphReference: graphReference\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/media/darcdev/Archivos/Usuario/1-ESTUDIO/UNIVERSIDAD/V SEMESTRE/INGENIERIA DE SOFTWARE I/Proyecto/implementaciÃ³n/frontend/components/Metric.js"],"names":["useEffect","useRef","Graph","format","parseISO","axios","getConfig","publicRuntimeConfig","publicConfig","Metric","disconnected","uuid","socket","type","mtToken","graphReference","fetchMetrics","data","dataResult","get","api_url","current","chart","dataset","datasets","orderData","reverse","Array","isArray","forEach","m","labels","push","createdat","value","update","error","on","payload","token","agent","metric","metrics","find","length","shift","labelM","dataM"],"mappings":"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","sourcesContent":["import { useEffect, useRef } from \"react\";\nimport Graph from \"../components/Graph\";\nimport format from \"date-fns/format\";\nimport { parseISO } from \"date-fns\";\nimport axios from \"axios\";\nimport getConfig from \"next/config\";\nconst { publicRuntimeConfig: publicConfig } = getConfig();\n\nexport default function Metric({ disconnected, uuid, socket, type, mtToken }) {\n  const graphReference = useRef();\n\n  useEffect(() => {\n    async function fetchMetrics() {\n      try {\n        const { data: dataResult } = await axios.get(\n          `${publicConfig.api_url}/api/metrics/${uuid}/${type}`\n        );\n        if (!graphReference.current) return;\n\n        const chart = graphReference.current;\n        const dataset = chart.data.datasets[0];\n        const data = chart.data;\n\n        const orderData = dataResult.reverse();\n        if (Array.isArray(orderData)) {\n          orderData.forEach((m) => {\n            data.labels.push(format(parseISO(m.createdat), \"HH:mm:ss\"));\n            dataset.data.push(m.value);\n            chart.update(\"none\");\n            chart.update();\n          });\n        }\n      } catch (error) {\n        return;\n      }\n    }\n    fetchMetrics();\n\n    if (socket) {\n      socket.on(\"agent/message\", (payload) => {\n        if (payload.token !== mtToken) return;\n\n        if (payload.agent.uuid === uuid) {\n          const metric = payload.metrics.find((m) => m.type === type);\n\n          if (!graphReference.current) return;\n\n          const chart = graphReference.current;\n          const data = chart.data.datasets[0].data;\n          const labels = chart.data.labels;\n\n          if (data.length >= 20) {\n            labels.shift();\n            data.shift();\n          }\n\n          const labelM = format(metric.createdat, \"HH:mm:ss\");\n          const dataM = metric.value;\n          labels.push(labelM);\n          data.push(dataM);\n\n          chart.update(\"active\");\n        }\n      });\n    }\n  }, [disconnected]);\n\n  return (\n    <div className=\"border-gray-200 rounded-lg h-auto md:p-4\t\">\n      <div className=\" bg-gray-50 p-2\">\n        <div className=\"h-auto\">\n          <Graph graphReference={graphReference} />\n        </div>\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}